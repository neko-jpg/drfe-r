# **DRFE-R: Distributed Ricci Flow Embedding with Rendezvous Mechanism**

## **— Coordinate-ID Paradoxの解消と理論的到達保証 —**

## **概要 (Abstract)**

本稿では、動的ネットワークにおける分散ルーティングプロトコル **DRFE-R** を提案する。従来の Ricci Flow を用いた双曲埋め込みアプローチにおいて、IDから直接座標を導出することはトポロジ依存性の観点から不可能であるという **Coordinate-ID Paradox** が指摘されていた。

DRFE-R はこの問題を解決するために、トポロジ非依存の「アンカー座標」とトポロジ依存の「ルーティング座標」を分離する **Rendezvous（ランデブー）機構** を導入する。また、Ricci曲率計算の計算量的課題に対して近似アルゴリズム（Sinkhorn/Forman）を採用し、局所解問題に対して **Gravity-Pressure (GP) ルーティング** を適用することで、理論的な到達保証と現実的なスケーラビリティを両立させる。

## **1\. 根本的課題：Coordinate-ID Paradox の定式化と解決**

### **1.1 不可能性の証明**

ノード $t$ のネットワーク上の座標 $z\_t$ が、ネットワークのトポロジ $G=(V, E)$ を入力とする埋め込みプロセス（Ricci flow等）によって決定される従属変数である限り、以下の関数 $f$ は一般に存在し得ない。

$$z\_t \= f(\\text{ID}\_t)$$  
**理由:** 同一の $\\text{ID}\_t$ を持つノードであっても、異なるトポロジ $G$ や異なる時刻 $T$ に配置されれば、Ricci flow の収束点 $z\_t$ は異なる値を取るためである。したがって、送信元が $\\text{ID}\_t$ のみから $z\_t$ を一意かつ正確に計算することは論理的に不可能である。

### **1.2 解決策：座標系の分離 (Dual Coordinate System)**

DRFE-R では、以下の2種類の座標系を定義することでこのパラドックスを回避する。

1. **アンカー座標** (Anchor Coordinate) $a(\\text{ID})$  
   * **定義:** ID からハッシュ関数等を用いて決定論的に導出される座標。  
   * **性質:** トポロジ非依存、静的、全ノードが計算可能。  
   * **例:** 双曲円板上の角度 $\\theta \= \\text{Hash}(\\text{ID})$、半径 $r \\approx 1$。  
2. **ルーティング座標 (Routing Coordinate)** $z\_u(t)$  
   * **定義:** Ricci flow と埋め込み最適化により動的に更新される座標。  
   * **性質:** トポロジ依存、時間依存、ノード自身とその近傍のみが知る。  
   * **役割:** 実際のパケット転送（Greedy Forwarding）に使用。

## **2\. アーキテクチャ：分散ランデブー機構**

宛先 $t$ の最新座標 $z\_t$ を送信元が知るための仕組みとして、クエリサーバを用いない分散解決策を採用する。

### **2.1 ホームノード (Home Node) の定義**

任意のノード $t$ に対し、そのアンカー座標 $a(\\text{ID}\_t)$ に幾何学的（双曲距離）に最も近いノードを **ホームノード** $h(t)$ と定義する。

$$h(t) \= \\arg \\min\_{v \\in V} d\_H(z\_v, a(\\text{ID}\_t))$$

### **2.2 プロトコルシーケンス**

1. 登録 (Registration):  
   ノード $t$ は定期的に、自身の最新のルーティング座標 $z\_t$（または自身への転送ポインタ）を含むパケットを、自身のアンカー座標 $a(\\text{ID}\_t)$ に向けて送信する。これにより $h(t)$ は $t$ の位置情報をソフトステートとして保持する。  
2. 転送 (Routing Phase):  
   送信元 $S$ が宛先 $D$ へパケットを送る際、以下の2フェーズを実行する。  
   * **フェーズ1 (Toward Anchor):** $S$ はパケットヘッダに $a(\\text{ID}\_D)$ をセットし、幾何ルーティングで送る。パケットは $h(D)$ に到達する。  
   * **フェーズ2 (Toward Destination):** $h(D)$ は内部テーブルから $D$ の最新座標 $z\_D$ を引き出し、パケットヘッダを書き換えて $z\_D$ へ転送する。

この方式により、送信元は「IDのみ」を知っていれば通信が可能となり、Paradox は解消される。

## **3\. ルーティングアルゴリズムと到達保証**

「双曲空間だから局所解がない」という仮定は、埋め込み誤差や動的変動を含む現実の系では成立しない。DRFE-R では、**Gravity-Pressure** (GP) **ルーティング** \[Cvetkovski–Crovella\] を採用し、理論的な到達保証を与える。

### **3.1 Gravity Mode (Greedy)**

通常時、パケットは双曲距離 $d\_H$ を最小化する隣接ノードへ転送される。

$$v\_{\\text{next}} \= \\arg \\min\_{v \\in N(u)} d\_H(z\_v, \\text{Target})$$

### **3.2 Pressure Mode (Recovery)**

Greedy が局所最小（Local Minimum）に陥った場合、GP アルゴリズムは「圧力（Pressure）」を用いてパケットを押し出す。

*   各ノードはパケットの訪問回数などの状態を持ち、ポテンシャル場を一時的に変形させることでループを回避し、脱出を図る。

### **3.3 到達性定理**

定理 1 (DRFE-R の到達保証):  
グラフ $G$ が連結であり、スパニングツリー $T$ が構築されている場合、GPルーティング（Tree Fallback を含む）は、任意の送信元から宛先へのパケット到達を保証する。
特に、Tree Mode における探索ステップ数 $S$ は、グラフのノード数を $N=|V|$ とすると、以下の上界を持つ。

$$ S \le 2(N - 1) $$

**証明の概要:**
Tree Mode はスパニングツリー上の **Pure DFS (深さ優先探索)** として実装される。DFSは各エッジを最大2回（下り・上り）しか通過しないため、オイラーツアーの長さ $2(N-1)$ が最大ホップ数となる。
これにより、TTL を $2(N-1)$ 以上に設定すれば、パケット損失は理論上発生しない。

## **4\. 計算量の最適化：Hybrid Ricci Flow**

Ollivier-Ricci (OR) 曲率の計算における最適輸送問題（$O(m^3)$）のコストを、現実的な範囲（$O(k)$〜$O(1)$）に抑制する。

### **4.1 プロトコルの分離 (Decoupling)**

* **転送プレーン:** 常に $O(k)$ の距離計算のみ。  
* **制御プレーン (Ricci Flow):** バックグラウンドで低頻度（周期 $T\_{\\text{flow}}$）かつ非同期に実行。パケット転送をブロックしない。

### **4.2 ハイブリッド近似戦略**

エッジ $(u, v)$ の次数 $\\deg(u), \\deg(v)$ に応じて計算手法を切り替える。

1. **低次数エッジ (Low Degree): Sinkhorn-Knopp 近似**  
   * 最適輸送をエントロピー正則化し、Sinkhorn 反復法で解く。  
   * 計算コストは大幅に低減されるが、OR曲率の性質をよく保持する。  
2. **高次数エッジ (High Degree): Jaccard / Forman 曲率**  
   * 計算コストが次数の3乗になることを避けるため、組み合わせ的な近似を用いる。  
   * Forman-Ricci 曲率:  
     $$\\text{Ric}\_F(e) \= 4 \- \\deg(u) \- \\deg(v)$$

     （重み無しの場合の簡易形）。計算量は $O(1)$。  
   * または **Generalized Jaccard Curvature** を使用。

この仕様により、「計算量が重すぎて実用不可能」という批判を完全に排除する。

## **5\. 動的安定性の確保**

ネットワークの変化に伴う座標 $z\_t$ の振動 (Oscillation) を抑制するための二重の対策。

### **5.1 近接正則化 (Proximal Regularization)**

座標更新の目的関数に、前回座標 $z\_u^{\\text{prev}}$ からの逸脱をペナルティとする項を追加する。

$$\\min\_{\\{z\_u\\}} \\sum\_{(u,v) \\in E} (d\_H(z\_u, z\_v) \- \\ell\_{uv})^2 \+ \\lambda \\sum\_{u} d\_H(z\_u, z\_u^{\\text{prev}})^2$$  
これにより、座標の急激な「飛び」を物理的に抑制し、ドリフトをLipschitz連続的に保つ。

### **5.2 ルーティングによる吸収**

前述の GP ルーティングの特性により、宛先 $t$ が移動してホームノードが保持する $z\_t$ がわずかに古くなったとしても、その近傍まで到達すれば、あとは Pressure モードが $t$ を探索・発見する。

## **6\. 結論**

DRFE-R は、以下の3点において従来の提案を修正・強化したものである。

1. **論理的整合性:** アンカー座標とランデブー機構の導入により、Coordinate-ID Paradox を解消した。  
2. **到達確実性:** 双曲空間の性質のみに依存せず、Gravity-Pressure ルーティングによりトポロジカルな到達保証を付与した。  
3. **計算実行可能性:** Ricci flow をバックグラウンド化し、次数に応じた近似計算を導入することで、スケーラビリティを確保した。

以上により、DRFE-R は動的大規模ネットワークにおける、理論的に堅牢かつ実用的なルーティングプロトコルであると結論付けられる。